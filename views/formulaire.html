<!DOCTYPE html>
<!-- 
	@author : Grï¿½goire Boiron <gregoire.boiron@gmail.com> 
	@version : 1.2
-->
  <html>
    <head>
      <!--Import Google Icon Font-->
      <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
      <!--Import materialize.css-->
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
	  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
      <!--Let browser know website is optimized for mobile-->
      <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	  
	  <!-- Include stylesheets -->
	  <link rel="stylesheet" type="text/css" href="css/main-style.css">	
    </head>
	
	<!-- https://docs.google.com/spreadsheets/d/1cuwb3QSvWDD7GG5McdvyyRBpqycYuKMRsXgyrvxvLFI/htmlembed -->

    <body>
		<nav>
		  <div class="nav-wrapper padding-left">
			<a href="" class="brand-logo">Spell Finder - Match the perfect spell</a>
			<ul id="nav-mobile" class="right hide-on-med-and-down">
			  <li><a href="">A propos</a></li>
			  <!--<li><a href="">sass <span class="new badge">4</span></a></li>
			  <li><a href="">sass</a></li>-->
			</ul>
		  </div>
		</nav>
		
		<nav class="padding-left">
			<div class="nav-wrapper">
			  <div id="navigation-bar" class="col s12">
				<a href="index.html" class="breadcrumb">Introduction</a>
				<a href="#!" onClick="window.location.reload()" class="breadcrumb">Crit&egrave;res</a>
				<!--
				<a href="#!" class="breadcrumb">Third</a>-->
			  </div>
			</div>
		</nav>
		
		<section id="center-section">
			<h1>Criteres</h1>
			
			<p>
				Entrez les differents param&egrave;tres du sort que vous cherchez.
				<br>
				Plus vous renseignerez de champs, plus la recherche sera pr&eacute;cise !
				<br>
				Pour prendre un compte un param&egrave;tre, activez le switch sur "On" et renseignez sa valeur.
			</p>
			
			<form action="#">
				<!-- School field -->
				<div class="field">
					<label>
						School
						<div class="switch">
							<label>
							Off
							<input id="school-switch" type="checkbox">
							<span class="lever"></span>
							On
							</label>
						</div>
					</label>
					<select id="school-value" class="browser-default">
						<option value="" disabled selected>Choose the spell's school</option>
						<option value="1">Abjuration</option>
						<option value="1">Conjuration</option>
						<option value="2">Divination</option>
						<option value="3">Enchantment</option>
						<option value="4">Evocation</option>
						<option value="5">Illusion</option>
						<option value="6">Necromancy</option>
						<option value="7">Transmutation</option>
					</select>
				</div>
				<div class="field">
					<!-- Components field -->
					<label>
						Components
						<div class="switch">
							<label>
							Off
							<input id="components-switch" type="checkbox">
							<span class="lever"></span>
							On
							</label>
						</div>
					</label>
					<div class="checkbox-div">
						<p>
							<input type="checkbox" class="components" id="V" />
							<label for="V">Verbal (V)</label>
						</p>
						<p>
							<input type="checkbox" class="components" id="S" />
							<label for="S">Somatic (S)</label>
						</p>
						<p>
							<input type="checkbox" class="components" id="M" />
							<label for="M">Material (M)</label>
						</p>
						<p>
							<input type="checkbox" class="components" id="F"  />
							<label for="F">Focus (F)</label>
						</p>
						<p>
							<input type="checkbox" class="components" id="DF" />
							<label for="DF">Divine Focus (DF)</label>
						</p>
					</div>
				</div>
				<div class="field">
					<!-- Level and Class field -->
					<label>
						Class
						<div class="switch">
							<label>
							Off
							<input id="level-switch" type="checkbox">
							<span class="lever"></span>
							On
							</label>
						</div>
					</label>
					<select id="class-value" class="browser-default">
						<option value="1">Barbarian</option>
						<option value="1">Bard</option>
						<option value="2">Cleric</option>
						<option value="3">Druid</option>
						<option value="4">Fighter</option>
						<option value="5">Monk</option>
						<option value="6">Paladin</option>
						<option value="7">Ranger</option>
						<option value="8">Rogue</option>
						<option value="9">Sorcerer</option>
						<option value="10">Wizard</option>
					</select>
					<label>
						Level 
					</label>
					<p class="range-field">
						<input type="range" id="level-value" min="0" max="9" />
					</p>
				</div>
				<!-- Range field -->
				<div class="field">
					<label>
						Range
						<div class="switch">
							<label>
							Off
							<input id="range-switch" type="checkbox">
							<span class="lever"></span>
							On
							</label>
						</div>
					</label>
					<select id="range-value" class="browser-default">
						<option value="" disabled selected>Choose the spell's range</option>
						<option value="1">Personal</option>
						<option value="2">Touch</option>
						<option value="3">Close</option>
						<option value="4">Medium</option>
						<option value="5">Long</option>
						<option value="6">Unlimited</option>
						<option value="7">Range Expressed in Feet</option>
					</select>
				</div>
				<div class="field">
					<label>
						Spell Resistance
						<div class="switch">
							<label>
							Off
							<input id="resistance-switch" type="checkbox">
							<span class="lever"></span>
							On
							</label>
						</div>
					</label>
					<div class="switch">
						<label>
						Non
						<input id="resistance-value" type="checkbox">
						<span class="lever"></span>
						Oui
						</label>
					</div>
				</div>
			</form>
			<br>
			<a class="waves-effect waves-light btn-large" id="compute"><i class="material-icons right">send</i>Chercher</a>
		</section>
		
		<section id="preloader" style="display: none;">
			<div class="preloader-wrapper big active">
				<div class="spinner-layer spinner-blue-only">
					<div class="circle-clipper left">
						<div class="circle"></div>
					</div><div class="gap-patch">
						<div class="circle"></div>
					</div><div class="circle-clipper right">
					<div class="circle"></div>
					</div>
				</div>
			</div>
		</section>
		
		<section id="results-section" style="display: none;">
			<ul id="tabs-swipe-demo" class="tabs">
				<li class="tab col s3"><a class="active" href="#swipe-1">R&eacute;sultats MongoDB (Map-Reduce)</a></li>
				<li class="tab col s3"><a href="#swipe-2">R&eacute;sultats SQLite (requete)</a></li>
			</ul>

			<div id="swipe-1">
				<table class="responsive-table">
					<thead>
						<tr>
							<th>Index</th>
							<th>Name</th>
							<th>School</th>
							<th>Level</th>
							<th>Components</th>
							<th>Range</th>
							<th>Spell Resistance</th>
						</tr>
					</thead>
					<tbody id="spells-table-mongo">
					
					</tbody>
				</table>
			</div>
			<div id="swipe-2">
				<table class="responsive-table">
					<thead>
						<tr>
							<th>Index</th>
							<th>Name</th>
							<th>School</th>
							<th>Level</th>
							<th>isVerbose</th>
							<th>isSomatic</th>
							<!--<th>Range</th>-->
							<th>Spell Resistance</th>
						</tr>
					</thead>
					<tbody id="spells-table-sqlite">
					
					</tbody>
				</table>
			</div>
		</section>

		<footer class="page-footer">
          <div class="container">
            <div class="row">
              <div class="col l6 s12">
                <h5 class="white-text">Objectifs</h5>
                <p class="grey-text text-lighten-4">Ce site a &eacute;t&eacute; r&eacute;alis&eacute; dans le cadre d'un cours dispens&eacute; &agrave; l'UQAC. Ce site &agrave; donc &eacute;t&eacute; fait &agrave; des fins p&eacute;dagogiques.</p>
              </div>
              <div class="col l4 offset-l2 s12">
                <h5 class="white-text">Liens</h5>
                <ul>
                  <li><a class="grey-text text-lighten-3" href="http://www.uqac.ca">UQAC</a></li>
                  <li><a class="grey-text text-lighten-3" href="https://github.com/edmondlachance/8INF803">GitHub du cours</a></li>
                  <li><a class="grey-text text-lighten-3" href="https://github.com/Graygzou/Spells-Finder">GitHub du projet</a></li>
                </ul>
              </div>
            </div>
          </div>
          <div class="footer-copyright">
            <div class="container">
             2018 Copyright
            </div>
          </div>
        </footer>
		
		<!--Import jQuery before materialize.js-->
		<script type="text/javascript" src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js"></script>
		<script src="socket.io/socket.io.js"></script>
		<script>
            var socket = io.connect("http://localhost:8080");
			var mongodbReady = false;
			var sqliteReady = true;
			
			// Get the results container
			var container = document.getElementById("results-section");
			
			// Message handler
			socket.on('results', function(message) {
				if(message['bdd'] == 'sqlite') {
					jsonObj = message['results'];
					

					var current_number = 1;
					// Add results
					for(index in jsonObj) {
						console.log(jsonObj[index]);
						
						var currentTR = document.createElement("tr");
						//currentTR.setAttribute("id", "myTr");
						document.getElementById("spells-table-sqlite").appendChild(currentTR);
						
						// Add the index
						var currentTD = document.createElement("td");
						var text = document.createTextNode(current_number);
						currentTD.appendChild(text);
						currentTR.appendChild(currentTD);
						
						for (var key in jsonObj[index]) {
							if (jsonObj[index].hasOwnProperty(key)) {
								currentTD = document.createElement("td");
								text = document.createTextNode(jsonObj[index][key]);
								currentTD.appendChild(text);
								currentTR.appendChild(currentTD);
							}
						}
						current_number++;
					}

					sqliteReady = true;
				} else if(message['bdd'] == 'mongodb') {
					jsonObj = message['results'];
					console.log(jsonObj);
					
					var current_number = 1;
					// Add results
					for(var spell in jsonObj) {
						console.log(jsonObj[spell]);
						
						var currentTR = document.createElement("tr");
						//currentTR.setAttribute("id", "myTr");
						document.getElementById("spells-table-mongo").appendChild(currentTR);
						
						// Add the index
						var currentTD = document.createElement("td");
						var text = document.createTextNode(current_number);
						currentTD.appendChild(text);
						currentTR.appendChild(currentTD);
						
						for (var key in jsonObj[spell]) {
							if (jsonObj[spell].hasOwnProperty(key)) {
								if(key == 'value') {
									for (var val in jsonObj[spell][key]) {
										console.log(val);
										currentTD = document.createElement("td");
										text = document.createTextNode(jsonObj[spell][key][val]);
										currentTD.appendChild(text);
										currentTR.appendChild(currentTD);
									}
								} else {
									console.log(key + " -> " + jsonObj[spell][key]);
									//container.innerHTML += key + " -> " + ;
									
									currentTD = document.createElement("td");
									text = document.createTextNode(jsonObj[spell][key]);
									currentTD.appendChild(text);
									currentTR.appendChild(currentTD);
								}
							}
						}
						current_number++;
					}
					mongodbReady = true;
				}
				if(sqliteReady && mongodbReady) {
					// Disable loading screen
					document.getElementById("preloader").style.display = "none";
					
					// Change page style
					var node = document.createElement('a');
					var textnode = document.createTextNode("Resultats");
					node.className += "breadcrumb";
					node.appendChild(textnode);
					document.getElementById("navigation-bar").appendChild(node);
					
					// Display results block
					container.style.display = "block";
				}
			});
			
			$('#compute').click(function () {
				document.getElementById("center-section").style.display = "none";
				document.getElementById("preloader").style.display = "block";
				
				// Retrieve data from the form
				var JSONdata = {};
				if(document.getElementById('school-switch').checked == true) {
					if($( "#school-value" ).val() != null) {
						JSONdata = $.extend(JSONdata, {'school': $('#school-value option:selected').text().toLowerCase()});
					}
				}
				// Retrieve components.
				if(document.getElementById('components-switch').checked == true) {
					componentsArray = [];
					//JSONdata = $.extend(JSONdata, {'component': document.getElementById('components-value option:selected').text()});
					var inputsComponent = $('input.components');
					console.log(inputsComponent);
					for(var i = 0; i < inputsComponent.length; i++) {
						var jsonComp = {};
						if(inputsComponent[i].checked == true) {
							// Get the component of this checkbox
							jsonComp[inputsComponent[i].id] = 1;
							componentsArray.push(jsonComp);
						} else {
							// This allow to filter some spell by not checking the checkbox
							jsonComp[inputsComponent[i].id] = 0;
							componentsArray.push(jsonComp);
						}
					}
					console.log(componentsArray);
					JSONdata = $.extend(JSONdata, {'components': componentsArray});
				}
				if(document.getElementById('level-switch').checked == true) {
					JSONdata = $.extend(JSONdata, { 'levels' : { 'class': $('#class-value option:selected').text().toLowerCase(), 'level' : document.getElementById('level-value').value}});
				}
				// Retrieve range.
				if(document.getElementById('range-switch').checked == true) {
					console.log($( "#range-value" ).val());
					if($( "#range-value" ).val() != null) {
						JSONdata = $.extend(JSONdata, {'range': $('#range-value option:selected').text().toLowerCase()});
					}
				}
				// Retrieve spell resistance.
				if(document.getElementById('resistance-switch').checked == true) {
					if(document.getElementById('resistance-value').checked == true) {
						JSONdata = $.extend(JSONdata, {'SpellResistance': 'yes'});
					} else {
						JSONdata = $.extend(JSONdata, {'SpellResistance': 'no'});
					}
				}
				console.log(JSONdata)
                socket.emit('compute', JSONdata);
            });
        </script>
	</body>
  </html>
        